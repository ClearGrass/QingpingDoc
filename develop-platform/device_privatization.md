# 设备私有化接入
## 1.定义
设备私有化，指通过配置设备的 MQTT 地址、入网凭证等信息，以及将设备注册到与客户平台，实现设备直接与客户平台进行通信。

## 2.产品

| 产品                          | 是否支持设备私有化      | 固件版本                         |
| ---------------------------- | -------------------- | ------------------------------- |
| 青萍温湿度气压计 NB-IoT 版      | 是                    | 1.0.2_0080 及以上                |
| 青萍温湿度气压计 Wi-Fi 版       | 是                    | 3.1.3_0087 及以上                |
| 青萍温湿度气压计 Link WAN 版    | 是                    |                                 |
| 青萍商用温湿度计 NB-IoT 版      | 是                    |                                 |
| 青萍商用温湿度计 Wi-Fi 版       | 是                    |                                 |
| 青萍商用温湿度计 Link WAN 版    | 是                    |                                 |

注：如设备的固件版本低于支持私有化的版本，请先将设备绑定到青萍物联 app 后并进行固件升级，升级成功后将重置。（如何重置，请参考附件说明）

## 3.接入指南

### 3.1 接入方式
NB-IoT 版和 Wi-Fi 版产品：支持阿里 IoT 和自建 MQTT 接入两种方式。
LinkWAN 版产品：支持阿里 IoT 接入。

### 3.2 接入阿里 IoT 平台

#### 3.2.1 参数配置
将以下参数在青萍物联 app 私有化功能中配置或青萍后台进行配置

| 参数                          | 说明                                                   |
| ---------------------------- | ----------------------------------------------------- |
| REGION ID                    | 开通的是哪个区域的物联网平台服务                           |
| ACCESS KEY                   | RAM 访问控制中创建一个用户并为其设置“管理物联网平台(IoT)的权限”，得到 AccessKey 和 AccessSecret（参考 3.2.3）        |
| ACCESS SECRET                | 如上                                                   |
| PRODUCT KEY                  | 阿里物联网平台创建产品，得到 ProductKey（参考 3.2.2）       |
| GROUP ID                     | 节点分组（仅针对 Link WAN 版本的产品）                     |

#### 3.2.2 创建产品
  - NB-IoT 设备：所属品类（自定义品类）、节点类型（直连设备）、联网方式（Wi-Fi）、数据格式（透传/自定义）、认证方式（设备密钥）。
  - Link WAN 设备：所属品类（自定义品类）、节点类型（网关子设备）、联网方式（Wi-Fi）、数据格式（透传/自定义）、认证方式（设备密钥）。
  - 创建完成后，列表中可看到 ProductKey。

#### 3.2.3 RAM 访问控制  
  - 创建一个用户并添加“管理物联网平台（IoT）的权限”。  
  - 点击用户信息详情，认证管理中“创建 AccessKey”，得到 AccessKey 和 AccessSecret。
  
### 3.2 自建 MQTT 服务
需客户提供 API 支持为每台设备下发以下参数，

| 参数                          | 说明                                                   |
| ---------------------------- | ----------------------------------------------------- |
| host                         | MQTT 服务地址                                           |
| port                         | 端口                                                   |
| username                     | 用户名                                                 |
| password                     | 密码                                                   |
| clientId                     | 客户 id                                                |
| publishTopic                 | 发布主题                                                |
| subscribeTopic               | 订阅主题                                                |


### 3.3 其它配置项
如果使用青萍物联 app 将设备设置为私有化，直接设置即可。
| 参数                          | 说明                                                   |
| ---------------------------- | ----------------------------------------------------- |
| 上报时间间隔（分钟）            | 设备定时主动联网上报历史数据和实时数据的时间间隔。默认是 60 分钟上报一次，最短可设置 10 分钟上报一次。|
| 采集间隔（分钟）                | 设备定时采集传感器读数的时间间隔。默认 15 分钟采集一次，建议最小可设置 1 分钟采集一次。（注意：设备 FLASH 有擦写寿命，每写满 4096 字节会擦一次，如果采集频率过高，会影响 FLASH 的寿命。）                                                   |
| 加密方式                      | 只适用 NB 设备。设备通信支持“不加密、固定密钥、一机一密”三种方式。|


## 1.定义
